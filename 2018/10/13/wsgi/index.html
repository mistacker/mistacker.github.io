<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="四处漂泊，落叶归根。"><title>WSGI的介绍 | Mistacker|博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">WSGI的介绍</h1><a id="logo" href="/.">Mistacker|博客</a><p class="description">孤帆远影碧空尽，唯见长江天际流。</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/comments/"><i class="fa fa-comments"> 留言</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">WSGI的介绍</h1><div class="post-meta">Oct 13, 2018<span> | </span><span class="category"><a href="/categories/python/">python</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h2 id="由来"><a href="#由来" class="headerlink" title="由来"></a>由来</h2><p>&emsp;&emsp; 在早期的<code>HTTP</code>编程中，许多<code>Python</code>服务都是被编写为简单的<code>CGI</code>脚本。每次收到请求就会出发<code>CGI</code>脚本。服务器对<code>HTTP</code>请求进行分割，将相应的参数以环境变量的形式传入<code>CGI</code>脚本中。<code>Python</code>程序员可以直接将这些输入参数和<code>HTTP</code>响应打印到标准输出，也可以借助标准库的<code>cgi</code>模块来查看。<br>&emsp;&emsp;在上面的方式会为每个接收到<code>HTTP</code>请求启动一个新的进程。这大大影响了服务器的性能，因此各种语言开始着手实现自己的<code>HTTP</code>服务器。<code>Python</code>在标准库中加入了<code>http.server</code>模块。使用该模块来实现服务时，程序员需要编写自己的子类继承<code>BaseHTTPRequestHandler</code>，并添加<code>do_GET()</code>和<code>do_POST()</code>方法。<br>&emsp;&emsp;其一些程序员想在支持返回动态页面的<code>Web</code>服务器上同事支持返回静态内容，因此出现了<code>mod_python</code>。<code>mod_python</code>是一个<code>Apache</code>模块，允许成功注册的<code>Python</code>函数提供自定义的<code>Apache</code>处理函数，并且在自定义处理函数中提供认证和日志功能以及返回内容。<code>mod_python</code>的<code>API</code>是<code>Apache</code>独有的。使用<code>Python</code>编写的处理函数接受一个特殊的<code>Apache request</code>对象。在处理函数内部，可以调用<code>apache</code>模块的特殊函数来与<code>Web</code>服务器进行交互。使用<code>mod_python</code>的应用程序与使用<code>CGI</code>或<code>http.server</code>编写的程序几乎毫无相似之处。<br>&emsp;&emsp;因此，在<code>Python</code>中使用上述不同方式编写<code>HTTP</code>应用程序，在设计与<code>Web</code>服务器交互的接口时都采用了某种特定的机制。使用<code>CGI</code>方式编写的服务至少需要重写一部分代码才能应用<code>http.server</code>。无论是使用<code>CGI</code>还是<code>http.server</code>编写的服务器程序，都需要经过修改才能够在<code>Apache</code>下运行。这使得<code>Python</code>网络服务的可移植性很差。<br>&emsp;&emsp;为了解决这一问题，<code>Python</code>社区在<code>PEP 333</code>中提出了<code>Web</code>服务器网管接口(<code>WSGI, Web Server Gateway Interface</code>)。而<code>WSGI</code>标准就是添加了一层中间层。通过这一中间层，用<code>Python</code>编写的<code>HTTP</code>服务就能够与任何<code>Web</code>服务器进行交互了。<code>WSGI</code>标准指定了一个调用惯例，如果所有主流的<code>Web</code>服务器的实现都遵循这一惯例，那么就能够直接在服务器中应用底层服务以及功能完整的<code>Web</code>框架，而无需修改原来的代码。各大<code>Web</code>服务器很快就遵循<code>WSGI</code>进行了实现。现在，<code>WSGI</code>已经成为了使用<code>Python</code>进行<code>HTTP</code>操作的标准方法。</p>
<h2 id="一个简单的HTTP服务"><a href="#一个简单的HTTP服务" class="headerlink" title="一个简单的HTTP服务"></a>一个简单的HTTP服务</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># A simple HTTP service built directly against the low-level WSGU spec.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pformat</span><br><span class="line"><span class="keyword">from</span> simple.simple_server <span class="keyword">import</span> make_server</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">app</span><span class="params">(environ, start_response)</span>:</span></span><br><span class="line">    headers = &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/plain; charset=utf-8"</span>&#125;</span><br><span class="line">    start_response(<span class="string">"200 OK"</span>, list(headers.items()))</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">"Here is the WSGI environment:\r\n\r\n"</span>.encode(<span class="string">"utf-8"</span>)</span><br><span class="line">    <span class="keyword">yield</span> pformat(environ).encode(<span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    httpd = make_server(<span class="string">""</span>, <span class="number">8000</span>, app)</span><br><span class="line">    host, port = httpd.socket.getsockname()</span><br><span class="line">    print(<span class="string">"Serving on"</span>, host, <span class="string">"port"</span>, port)</span><br><span class="line">    httpd.server_forever()</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;根据标准的定义，<code>WSGI</code>应用程序是可以被调用的，并且有两个输入参数。上面代码则是一个展示例子，其中使用一个简单的<code>Python</code>函数来表示可调用的<code>WSGI</code>应用程序。第一个参数是<code>environ</code>，用于接受一个字典，字典中提供的键值对是旧式的<code>CGI</code>环境变量集合的扩展。第二个参数本身是可以被调用的，习惯上会将其命名为<code>start_response()</code>，<code>WSGI</code>应用程序通过<code>start_response()</code>来声明响应头信息。被调用后，<code>app</code>函数可以开始生成字节字符串，也可以返回一个可迭代对象。该对象可以在迭代过程中生成字符串。<br>&emsp;&emsp;只看代码的话，你可能会觉得WSGI很简单，这是因为上面的代码只选择了一种简单的处理方式，没有展示出<code>WSGI</code>标准的完整说明而已。实际编写服务器程序时，复杂度就大大提升了。如果想了解相关细节的话，可以阅读<a href="https://www.python.org/dev/peps/pep-3333/" target="_blank" rel="noopener">PEP 3333</a>提出的现代<code>Python3</code>版本的<code>WSGI</code>。</p>
<h2 id="发展"><a href="#发展" class="headerlink" title="发展"></a>发展</h2><p>&emsp;&emsp;<code>WSGI</code>出现后，<code>WSGI</code>中间件的思想开始广为流传。未来<code>Python</code>服务可能应该被设计为一系列<code>WSGI</code>包装的函数。其中，有的包装函数会提供认证功能；有的会负责捕捉异常，记录日志；而有的则负责对指向仍然在机构中运行的老旧的<code>CMS</code>的<code>URL</code>进行反向代理，使用<code>Diazo</code>将这些<code>URL</code>重构，使之指向项目中最新页面。<br>&emsp;&emsp;尽管仍然有一些开发者会编写并使用<code>WSGI</code>中间件，但是现在大多数<code>Python</code>程序员使用<code>WSGI</code>的主要原因是它提供应用程序或框架与监听<code>HTTP</code>请求的<code>Web</code>服务器之间的可插拔性。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://mistacker.github.io/2018/10/13/wsgi/" data-id="cjny8uev8000vlo6i3ewofeiv" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKUlEQVR42u3ay27CMBAF0P7/T1OpKzYk944DKs7JClXg+Hgx9Tx+fuLn8fc8f37+y6u/t995tfJlDwYGxtcyHodP/oJkhfy3+d4wMDDuw1gJsklIXQ/HJ3vGwMDAKF9//M38sDAwMDBWGDNYfh3EwMDAmCWxLaMNsh/KxTEwML6QMWsMfObz2/sbGBgY/57xKJ+2GdCW/oe7wsDA2JrRFu5XGpZX/WcobrgYGBhbMFYakElC2wbN4XsxMDBuwGjD3zopSZWLY8XAwLglow2g7RjZVRfQYtYDAwNjC8Z64SwJzcnlLx/jKKqGGBgYWzDaFLTd+nqQfbkmBgbG1oyVeYYk+ax7FMvtBwwMjF0Zs3GKJE3NN5qfbjRsgYGBsREjv3itJJxtY6Ae2sDAwNiakRfF8kZjXixrmxAnLU8MDIytGe3FblY4a0PwCg8DA2M/xmxgIk9x23VmrQIMDIxdGfmLZ5ubNTWTIH6Si2NgYGzESAJrfrtshzPawzo5MgwMjE0Zw2LWaHgrD9D5GAcGBgbGUhSPC3ntaidJLAYGxnaMfFR0Nlp6vEJ+BMUOMTAwtmOslPXzIDgboSjanxgYGFsz8qctul37q3YcBAMDYz/Gu1uY+YWvTXcxMDDuxpgNqrYXuPaaWKS7GBgYGKNBimS1Wet0KeBiYGDcgJEjk0R0PXJiYGDch3FVSzLHrDdHMTAw7sOYpY55gez4IJLS/wXNSwwMjG9l/AIpEAo/yBJGpgAAAABJRU5ErkJggg==">分享</a><div class="tags"><a href="/tags/WSGI/">WSGI</a></div><div class="post-nav"><a class="pre" href="/2018/10/13/thread/">python的多线程</a></div><div id="lv-container" data-id="city" data-uid="MTAyMC8zOTk4Ny8xNjUxNA=="><script>(function(d, s) {
   var j, e = d.getElementsByTagName(s)[0];
   if (typeof LivereTower === 'function') { return; }
   j = d.createElement(s);
   j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
   j.async = true;
   e.parentNode.insertBefore(j, e);
})(document, 'script');
</script></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><input class="st-default-search-input" placeholder="Search" type="text"/></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/URL/">URL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/python/flask/">flask</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/scrapy/">scrapy</a></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/mongodb/" style="font-size: 15px;">mongodb</a> <a href="/tags/HTML遍历/" style="font-size: 15px;">HTML遍历</a> <a href="/tags/bs4/" style="font-size: 15px;">bs4</a> <a href="/tags/celery/" style="font-size: 15px;">celery</a> <a href="/tags/tkinter/" style="font-size: 15px;">tkinter</a> <a href="/tags/email/" style="font-size: 15px;">email</a> <a href="/tags/linkextractor/" style="font-size: 15px;">linkextractor</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/习题/" style="font-size: 15px;">习题</a> <a href="/tags/lxml/" style="font-size: 15px;">lxml</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/osroom/" style="font-size: 15px;">osroom</a> <a href="/tags/RESTful-api/" style="font-size: 15px;">RESTful-api</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/WSGI/" style="font-size: 15px;">WSGI</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/信号/" style="font-size: 15px;">信号</a> <a href="/tags/blinker/" style="font-size: 15px;">blinker</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/01/docker/">Docker的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/24/linkextractor/">LinkExtractor的简单使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/bs4_and_lxml/">网页爬虫---html的遍历</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/16/design/">一个设计签名的小程序</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/15/osroom/">OSROOM安装使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/14/signal/">Flask中的信号</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/13/problem/">一些练习题</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/13/email/">电子邮件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/13/nginx/">nginx的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/13/celery/">Celery的介绍</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.yangqq.com/" title="杨青个人博客" target="_blank">杨青个人博客</a><ul></ul><a href="https://www.oschina.net/project" title="开源中国项目" target="_blank">开源中国项目</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Mistacker|博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://mistacker.github.io"> Mistacker | 个人专属</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
_st('install','cxRJFkZr9xPGAhZDVN82','2.0.0');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/haru02.model.json"},"display":{"position":"right","width":120,"height":240},"mobile":{"show":true},"log":false});</script></body></html>